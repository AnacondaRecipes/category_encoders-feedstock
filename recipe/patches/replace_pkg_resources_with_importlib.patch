From 401267aeaf250e50da1ced38a311f8efa49a81a0 Mon Sep 17 00:00:00 2001
From: Nicholas Bollweg <nick.bollweg@gmail.com>
Date: Mon, 15 May 2023 21:08:03 -0500
Subject: [PATCH 1/2] replace pkg_resources with importlib.resources

---
 category_encoders/datasets/_base.py | 14 +++++++++-----
 requirements.txt                    |  1 +
 setup.py                            |  1 +
 3 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/category_encoders/datasets/_base.py b/category_encoders/datasets/_base.py
index deae12f1..80f602e8 100644
--- a/category_encoders/datasets/_base.py
+++ b/category_encoders/datasets/_base.py
@@ -2,7 +2,11 @@
 Base IO code for datasets
 """

-import pkg_resources
+try:
+    from importlib.resources import files, as_file
+except ImportError:
+    from importlib_resources import files, as_file
+
 import pandas as pd

 def load_compass():
@@ -21,9 +25,9 @@ def load_compass():

     """
     data_filename = "data/compass.csv"
-    stream = pkg_resources.resource_filename(__name__, data_filename)
+    stream = files(__name__) / data_filename

-    with open(stream) as f:
+    with as_file(stream) as f:
         df = pd.read_csv(f, encoding='latin-1')
     X = df[['index', 'compass', 'HIER_compass_1']]
     y = df['target']
@@ -56,9 +60,9 @@ def load_postcodes(target_type='binary'):

     """
     data_filename = "data/postcode_dataset_100.csv"
-    stream = pkg_resources.resource_filename(__name__, data_filename)
+    stream = files(__name__) / data_filename

-    with open(stream) as f:
+    with as_file(stream) as f:
         df = pd.read_csv(f, encoding='latin-1')
     X = df[df.columns[~df.columns.str.startswith('target')]]
     y = df[f'target_{target_type}']
diff --git a/requirements.txt b/requirements.txt
index 9a030621..f934d7ee 100644
--- a/requirements.txt
+++ b/requirements.txt
@@ -5,3 +5,4 @@ statsmodels>=0.9.0
 pandas>=1.0.5
 patsy>=0.5.1
 unittest2
+importlib_resources ; python_version<"3.9"
diff --git a/setup.py b/setup.py
index 67f2c6c1..406f79f7 100644
--- a/setup.py
+++ b/setup.py
@@ -38,6 +38,7 @@
       'statsmodels>=0.9.0',
       'pandas>=1.0.5',
       'patsy>=0.5.1',
+      'importlib_resources ; python_version<"3.9"',
     ],
     author_email='will@pedalwrencher.com',
     package_data={'': ['datasets/data/*.csv']},

From 6b07130c6f3d64de57c505021732a7e6a49928fe Mon Sep 17 00:00:00 2001
From: Nicholas Bollweg <nick.bollweg@gmail.com>
Date: Mon, 15 May 2023 21:17:37 -0500
Subject: [PATCH 2/2] use package name literal

---
 category_encoders/datasets/_base.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/category_encoders/datasets/_base.py b/category_encoders/datasets/_base.py
index 80f602e8..bb168da1 100644
--- a/category_encoders/datasets/_base.py
+++ b/category_encoders/datasets/_base.py
@@ -25,7 +25,7 @@ def load_compass():

     """
     data_filename = "data/compass.csv"
-    stream = files(__name__) / data_filename
+    stream = files("category_encoders.datasets") / data_filename

     with as_file(stream) as f:
         df = pd.read_csv(f, encoding='latin-1')
@@ -60,7 +60,7 @@ def load_postcodes(target_type='binary'):

     """
     data_filename = "data/postcode_dataset_100.csv"
-    stream = files(__name__) / data_filename
+    stream = files("category_encoders.datasets") / data_filename

     with as_file(stream) as f:
         df = pd.read_csv(f, encoding='latin-1')